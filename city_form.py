from datetime import datetime, timedelta
from flask import flash

# List of valid cities and postal codes
VALID_CITIES = {'Aalst': ['9300', '9308', '9310', '9320'], 'Aalter': ['9880', '9881', '9910'], 'Aarschot': ['3200', '3201', '3202'], 'Aartselaar': ['2630'], 'Affligem': ['1790'], 'Alken': ['3570'], 'Alveringem': ['8690', '8691'], 'Antwerpen': ['2000', '2018', '2020', '2030', '2040', '2050', '2060', '2100', '2140', '2170', '2180', '2600', '2610', '2660'], 'Anzegem': ['8570', '8572', '8573'], 'Ardooie': ['8850', '8851'], 'Arendonk': ['2370'], 'As': ['3665', '3668'], 'Asse': ['1730', '1731'], 'Assenede': ['9960', '9961', '9968'], 'Avelgem': ['8580', '8581', '8582', '8583'], 'Baarle-Hertog': ['2387'], 'Balen': ['2490', '2491'], 'Beernem': ['8730'], 'Beerse': ['2340'], 'Beersel': ['1650', '1651', '1652', '1653', '1654'], 'Begijnendijk': ['3130'], 'Bekkevoort': ['3460', '3461'], 'Beringen': ['3580', '3581', '3582', '3583'], 'Berlaar': ['2590'], 'Berlare': ['9290'], 'Bertem': ['3060', '3061'], 'Bever': ['1547'], 'Beveren': ['9120', '9130'], 'Bierbeek': ['3360'], 'Bilzen': ['3740', '3742', '3746'], 'Blankenberge': ['8370'], 'Bocholt': ['3950'], 'Boechout': ['2530', '2531'], 'Bonheiden': ['2820'], 'Boom': ['2850'], 'Boortmeerbeek': ['3190', '3191'], 'Borgloon': ['3840'], 'Bornem': ['2880'], 'Borsbeek': ['2150'], 'Boutersem': ['3370'], 'Brakel': ['9660', '9661'], 'Brasschaat': ['2930'], 'Brecht': ['2960'], 'Bredene': ['8450'], 'Bree': ['3960'], 'Brugge': ['8000', '8200', '8310', '8380'], 'Buggenhout': ['9255'], 'Damme': ['8340'], 'De Haan': ['8420', '8421'], 'De Panne': ['8660'], 'De Pinte': ['9840'], 'Deerlijk': ['8540'], 'Deinze': ['9800', '9850'], 'Denderleeuw': ['9470', '9472', '9473'], 'Dendermonde': ['9200'], 'Dentergem': ['8720'], 'Dessel': ['2480'], 'Destelbergen': ['9070'], 'Diepenbeek': ['3590'], 'Diest': ['3290', '3293', '3294'], 'Diksmuide': ['8600'], 'Dilbeek': ['1700', '1701', '1702', '1703'], 'Dilsen-Stokkem': ['3650'], 'Drogenbos': ['1620'], 'Duffel': ['2570'], 'Edegem': ['2650'], 'Eeklo': ['9900'], 'Erpe-Mere': ['9420'], 'Essen': ['2910'], 'Evergem': ['9940'], 'Galmaarden': ['1570'], 'Gavere': ['9890'], 'Geel': ['2440'], 'Geetbets': ['3450', '3454'], 'Genk': ['3600'], 'Gent': ['9000', '9030', '9031', '9032', '9040', '9041', '9042', '9050', '9051', '9052'], 'Geraardsbergen': ['9500', '9506'], 'Gingelom': ['3890', '3891'], 'Gistel': ['8470'], 'Glabbeek': ['3380', '3381', '3384'], 'Gooik': ['1755'], 'Grimbergen': ['1850', '1851', '1852', '1853'], 'Grobbendonk': ['2280', '2288'], 'Haacht': ['3150'], 'Haaltert': ['9450', '9451'], 'Halen': ['3545'], 'Halle': ['1500', '1501', '1502'], 'Ham': ['3945'], 'Hamme': ['9220'], 'Hamont-Achel': ['3930'], 'Harelbeke': ['8530', '8531'], 'Hasselt': ['3500', '3501', '3510', '3511', '3512'], 'Hechtel-Eksel': ['3940', '3941'], 'Heers': ['3870'], 'Heist-op-den-Berg': ['2220', '2221', '2222', '2223'], 'Hemiksem': ['2620'], 'Herent': ['3020'], 'Herentals': ['2200'], 'Herenthout': ['2270'], 'Herk-de-Stad': ['3540'], 'Herne': ['1540', '1541'], 'Herselt': ['2230'], 'Herstappe': ['3717'], 'Herzele': ['9550', '9551', '9552'], 'Heusden-Zolder': ['3550'], 'Heuvelland': ['8950', '8951', '8952', '8953', '8954', '8956', '8958'], 'Hoegaarden': ['3320', '3321'], 'Hoeilaart': ['1560'], 'Hoeselt': ['3730', '3732'], 'Holsbeek': ['3220', '3221'], 'Hooglede': ['8830'], 'Hoogstraten': ['2320', '2321', '2322', '2323', '2328'], 'Horebeke': ['9667'], 'Houthalen-Helchteren': ['3530'], 'Houthulst': ['8650'], 'Hove': ['2540'], 'Huldenberg': ['3040'], 'Hulshout': ['2235'], 'Ichtegem': ['8480'], 'Ieper': ['8900', '8902', '8904', '8906', '8908'], 'Ingelmunster': ['8770'], 'Izegem': ['8870'], 'Jabbeke': ['8490'], 'Kalmthout': ['2920'], 'Kampenhout': ['1910'], 'Kapellen': ['2950'], 'Kapelle-op-den-Bos': ['1880'], 'Kaprijke': ['9970', '9971'], 'Kasterlee': ['2460'], 'Keerbergen': ['3140'], 'Kinrooi': ['3640'], 'Kluisbergen': ['9690'], 'Knokke-Heist': ['8300', '8301'], 'Koekelare': ['8680'], 'Koksijde': ['8670'], 'Kontich': ['2550'], 'Kortemark': ['8610'], 'Kortenaken': ['3470', '3471', '3472', '3473'], 'Kortenberg': ['3070', '3071', '3078'], 'Kortessem': ['3720', '3721', '3722', '3723', '3724'], 'Kortrijk': ['8500', '8501', '8510', '8511'], 'Kraainem': ['1950'], 'Kruibeke': ['9150'], 'Kruisem': ['9750', '9770', '9771', '9772'], 'Kuurne': ['8520'], 'Laakdal': ['2430', '2431'], 'Laarne': ['9270'], 'Lanaken': ['3620', '3621'], 'Landen': ['3400', '3401', '3404'], 'Langemark-Poelkapelle': ['8920'], 'Lebbeke': ['9280'], 'Lede': ['9340'], 'Ledegem': ['8880'], 'Lendelede': ['8860'], 'Lennik': ['1750'], 'Leopoldsburg': ['3970', '3971'], 'Leuven': ['3000', '3001', '3010', '3012', '3018'], 'Lichtervelde': ['8810'], 'Liedekerke': ['1770'], 'Lier': ['2500'], 'Lierde': ['9570', '9571', '9572'], 'Lievegem': ['9920', '9921', '9930', '9931', '9932', '9950'], 'Lille': ['2275'], 'Linkebeek': ['1630'], 'Lint': ['2547'], 'Linter': ['3350'], 'Lochristi': ['9080'], 'Lokeren': ['9160'], 'Lommel': ['3920'], 'Londerzeel': ['1840'], 'Lo-Reninge': ['8647'], 'Lubbeek': ['3210', '3211', '3212'], 'Lummen': ['3560'], 'Maarkedal': ['9680', '9681', '9688'], 'Maaseik': ['3680'], 'Maasmechelen': ['3630', '3631'], 'Machelen': ['1830', '1831'], 'Maldegem': ['9990', '9991', '9992'], 'Malle': ['2390'], 'Mechelen': ['2800', '2801', '2811', '2812'], 'Meerhout': ['2450'], 'Meise': ['1860', '1861'], 'Melle': ['9090'], 'Menen': ['8930'], 'Merchtem': ['1785'], 'Merelbeke': ['9820'], 'Merksplas': ['2330'], 'Mesen': ['8957'], 'Meulebeke': ['8760'], 'Middelkerke': ['8430', '8431', '8432', '8433', '8434'], 'Moerbeke': ['9180'], 'Mol': ['2400'], 'Moorslede': ['8890'], 'Mortsel': ['2640'], 'Nazareth': ['9810'], 'Niel': ['2845'], 'Nieuwerkerken': ['3850'], 'Nieuwpoort': ['8620'], 'Nijlen': ['2560'], 'Ninove': ['9400', '9401', '9402', '9403', '9404', '9406'], 'Olen': ['2250'], 'Oostende': ['8400'], 'Oosterzele': ['9860'], 'Oostkamp': ['8020'], 'Oostrozebeke': ['8780'], 'Opwijk': ['1745'], 'Oudenaarde': ['9700'], 'Oudenburg': ['8460'], 'Oud-Heverlee': ['3050', '3051', '3052', '3053', '3054'], 'Oudsbergen': ['3660', '3670'], 'Oud-Turnhout': ['2360'], 'Overijse': ['3090'], 'Peer': ['3990'], 'Pelt': ['3900', '3910'], 'Pepingen': ['1670', '1671', '1673', '1674'], 'Pittem': ['8740'], 'Poperinge': ['8970', '8972', '8978'], 'Putte': ['2580'], 'Puurs-Sint-Amands': ['2870', '2890'], 'Ranst': ['2520'], 'Ravels': ['2380', '2381', '2382'], 'Retie': ['2470'], 'Riemst': ['3770'], 'Rijkevorsel': ['2310'], 'Roeselare': ['8800'], 'Ronse': ['9600'], 'Roosdaal': ['1760', '1761'], 'Rotselaar': ['3110', '3111', '3118'], 'Ruiselede': ['8755'], 'Rumst': ['2840'], 'Schelle': ['2627'], 'Scherpenheuvel-Zichem': ['3270', '3271', '3272'], 'Schilde': ['2970'], 'Schoten': ['2900'], 'Sint-Genesius-Rode': ['1640'], 'Sint-Gillis-Waas': ['9170'], 'Sint-Katelijne-Waver': ['2860', '2861'], 'Sint-Laureins': ['9980', '9981', '9982', '9988'], 'Sint-Lievens-Houtem': ['9520', '9521'], 'Sint-Martens-Latem': ['9830', '9831'], 'Sint-Niklaas': ['9100', '9111', '9112'], 'Sint-Pieters-Leeuw': ['1600', '1601', '1602'], 'Sint-Truiden': ['3800', '3803', '3806'], 'Spiere-Helkijn': ['8587'], 'Stabroek': ['2940'], 'Staden': ['8840'], 'Steenokkerzeel': ['1820'], 'Stekene': ['9190'], 'Temse': ['9140'], 'Ternat': ['1740', '1741', '1742'], 'Tervuren': ['3080'], 'Tessenderlo': ['3980'], 'Tielt': ['8700'], 'Tielt-Winge': ['3390', '3391'], 'Tienen': ['3300'], 'Tongeren': ['3700'], 'Torhout': ['8820'], 'Tremelo': ['3120', '3128'], 'Turnhout': ['2300'], 'Veurne': ['8630'], 'Vilvoorde': ['1800'], 'Vleteren': ['8640'], 'Voeren': ['3790', '3791', '3792', '3793', '3798'], 'Vorselaar': ['2290'], 'Vosselaar': ['2350'], 'Waasmunster': ['9250'], 'Wachtebeke': ['9185'], 'Waregem': ['8790', '8791', '8792', '8793'], 'Wellen': ['3830', '3831', '3832'], 'Wemmel': ['1780'], 'Wervik': ['8940'], 'Westerlo': ['2260'], 'Wetteren': ['9230'], 'Wevelgem': ['8560'], 'Wezembeek-Oppem': ['1970'], 'Wichelen': ['9260'], 'Wielsbeke': ['8710'], 'Wijnegem': ['2110'], 'Willebroek': ['2830'], 'Wingene': ['8750'], 'Wommelgem': ['2160'], 'Wortegem-Petegem': ['9790'], 'Wuustwezel': ['2990'], 'Zandhoven': ['2240', '2242', '2243'], 'Zaventem': ['1930', '1932', '1933'], 'Zedelgem': ['8210', '8211'], 'Zele': ['9240'], 'Zelzate': ['9060'], 'Zemst': ['1980', '1981', '1982'], 'Zoersel': ['2980'], 'Zonhoven': ['3520'], 'Zonnebeke': ['8980'], 'Zottegem': ['9620'], 'Zoutleeuw': ['3440'], 'Zuienkerke': ['8377'], 'Zulte': ['9870'], 'Zutendaal': ['3690'], 'Zwalm': ['9630', '9636'], 'Zwevegem': ['8550', '8551', '8552', '8553', '8554'], 'Zwijndrecht': ['2070'], 'Anderlecht': ['1070'], 'Brussel': ['1000', '1020', '1040', '1120', '1130 '], 'Elsene': ['1050'], 'Etterbeek': ['1040'], 'Evere': ['1140'], 'Ganshoren': ['1083'], 'Jette': ['1090'], 'Koekelberg': ['1081'], 'Oudergem': ['1160'], 'Schaarbeek': ['1030'], 'Sint-Agatha-Berchem': ['1082'], 'Sint-Gillis': ['1060'], 'Sint-Jans-Molenbeek': ['1080'], 'Sint-Joost-ten-Node': ['1210'], 'Sint-Lambrechts-Woluwe': ['1200'], 'Sint-Pieters-Woluwe': ['1150'], 'Ukkel': ['1180'], 'Vorst': ['1190'], 'Watermaal-Bosvoorde': ['1170']}

# Function to get the last five days
def get_last_five_days():
    today = datetime.today()
    days = [(today - timedelta(days=i)).strftime('%A') for i in range(1, 6)]
    return days[::-1]

def is_valid_city_or_postal_code(city):
    # Check if city exists in the dictionary
    if city.lower().title() in VALID_CITIES:
        return True
    # Check if postal code exists in any city's list of postal codes
    for valid_postal_codes in VALID_CITIES.values():
        if city in valid_postal_codes:
            return True
    return False

def is_postal_code(city):
    for valid_postal_codes in VALID_CITIES.values():
        if city in valid_postal_codes:
            return True
    return False

def postal_code(city):
    if is_postal_code(city):
        for city_name, postal_codes in VALID_CITIES.items():
            if city in postal_codes:
                return city_name
    else:
        return city.lower().title()

# Function to process form data
def process_form_data(city, day_values):
    # Validate city or postal code
    if not is_valid_city_or_postal_code(city):
        flash("Please enter a valid city or postcode.")
        return None, False

    # Ensure all dropdowns are selected
    if not all(day_values):
        flash("Please select a level for each day.")
        return None, False
    
    # Simulate calculations
    results = {"city": postal_code(city), "levels": day_values, "summary": "Sample Calculation Result"}
    return results, True
